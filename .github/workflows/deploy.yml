name: "Deploy to AWS Amplify production branch"
on:
  workflow_run:
    workflows: ["Login to Docker Hub and push container"]
    types: [completed]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  deploy-to-aws:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    timeout-minutes: 1
    runs-on: ubuntu-latest
    env:
      AWS_AMPLIFY_PROD_WEBHOOK: ${{ secrets.AWS_AMPLIFY_PROD_WEBHOOK }}

    steps:
      - name: Trigger AWS Amplify webhook
        run: |
          curl -X POST -d {} $AWS_AMPLIFY_PROD_WEBHOOK -H "Content-Type:application/json"
